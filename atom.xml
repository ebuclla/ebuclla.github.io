<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Hexo</title>
  
  
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2025-10-15T12:57:37.198Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>John Doe</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>某学校某课程的作业</title>
    <link href="http://example.com/2025/04/25/%E7%AC%AC%E4%B8%80%E8%8A%82%E4%BD%9C%E4%B8%9A/"/>
    <id>http://example.com/2025/04/25/%E7%AC%AC%E4%B8%80%E8%8A%82%E4%BD%9C%E4%B8%9A/</id>
    <published>2025-04-25T07:03:02.565Z</published>
    <updated>2025-10-15T12:57:37.198Z</updated>
    
    <content type="html"><![CDATA[<h1 id="第一节课作业-ssh爆破和后门"><a href="#第一节课作业-ssh爆破和后门" class="headerlink" title="第一节课作业 ssh爆破和后门"></a>第一节课作业 ssh爆破和后门</h1><h2 id="一、上课作业"><a href="#一、上课作业" class="headerlink" title="一、上课作业"></a>一、上课作业</h2><p>创建用户，并设置密码</p><p>![屏幕截图 2025-03-29 170121](file://E:\blog\source_posts\第一节作业.assets\屏幕截图 2025-03-29 170121.png?lastModify=1760532833)</p><p>开启SSH服务</p><p><img lazyload="" src="/images/loading.svg" data-src="/%E7%AC%AC%E4%B8%80%E8%8A%82%E4%BD%9C%E4%B8%9A.assets/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-03-29%20170242.png" alt="屏幕截图 2025-03-29 170242"></p><p>123???</p><p>![屏幕截图 2025-03-29 170242](file://E:\blog\source_posts\第一节作业.assets\屏幕截图 2025-03-29 170242.png?lastModify=1760532920)</p><p>kaliuser远程登录</p><p><img lazyload="" src="/images/loading.svg" data-src="/%E7%AC%AC%E4%B8%80%E8%8A%82%E4%BD%9C%E4%B8%9A.assets/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-03-29%20170340.png" alt="屏幕截图 2025-03-29 170340"></p><p>hydra爆破</p><p><img lazyload="" src="/images/loading.svg" data-src="/%E7%AC%AC%E4%B8%80%E8%8A%82%E4%BD%9C%E4%B8%9A.assets/image-20250411134925660.png" alt="image-20250411134925660"></p><h2 id="二、C-S配置文件解读"><a href="#二、C-S配置文件解读" class="headerlink" title="二、C/S配置文件解读"></a>二、C/S配置文件解读</h2><h3 id="（1）服务端配置文件"><a href="#（1）服务端配置文件" class="headerlink" title="（1）服务端配置文件"></a>（1）服务端配置文件</h3><p>读取服务端配置文件</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/ssh/sshd_config</span><br></pre></td></tr></tbody></table></figure></div><p><img lazyload="" src="/images/loading.svg" data-src="/%E7%AC%AC%E4%B8%80%E8%8A%82%E4%BD%9C%E4%B8%9A.assets/image-20250411135254475.png" alt="image-20250411135254475"></p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"># This is the sshd server system-wide configuration file.  See</span><br><span class="line"># sshd_config(5) for more information.</span><br><span class="line"></span><br><span class="line"># This sshd was compiled with PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games</span><br><span class="line"></span><br><span class="line"># The strategy used for options in the default sshd_config shipped with</span><br><span class="line"># OpenSSH is to specify options with their default value where</span><br><span class="line"># possible, but leave them commented.  Uncommented options override the</span><br><span class="line"># default value.</span><br><span class="line"></span><br><span class="line">Include /etc/ssh/sshd_config.d/*.conf</span><br><span class="line"></span><br><span class="line">#Port 22</span><br><span class="line">#AddressFamily any</span><br><span class="line">#ListenAddress 0.0.0.0</span><br><span class="line">#ListenAddress ::</span><br><span class="line"></span><br><span class="line">#HostKey /etc/ssh/ssh_host_rsa_key</span><br><span class="line">#HostKey /etc/ssh/ssh_host_ecdsa_key</span><br><span class="line">#HostKey /etc/ssh/ssh_host_ed25519_key</span><br><span class="line"></span><br><span class="line"># Ciphers and keying</span><br><span class="line">#RekeyLimit default none</span><br><span class="line"></span><br><span class="line"># Logging</span><br><span class="line">#SyslogFacility AUTH</span><br><span class="line">#LogLevel INFO</span><br><span class="line"></span><br><span class="line"># Authentication:</span><br><span class="line"></span><br><span class="line">#LoginGraceTime 2m</span><br><span class="line">#PermitRootLogin prohibit-password</span><br><span class="line">#StrictModes yes</span><br><span class="line">#MaxAuthTries 6</span><br><span class="line">#MaxSessions 10</span><br><span class="line"></span><br><span class="line">#PubkeyAuthentication yes</span><br><span class="line"></span><br><span class="line"># Expect .ssh/authorized_keys2 to be disregarded by default in future.</span><br><span class="line">#AuthorizedKeysFile.ssh/authorized_keys .ssh/authorized_keys2</span><br><span class="line"></span><br><span class="line">#AuthorizedPrincipalsFile none</span><br><span class="line"></span><br><span class="line">#AuthorizedKeysCommand none</span><br><span class="line">#AuthorizedKeysCommandUser nobody</span><br><span class="line"></span><br><span class="line"># For this to work you will also need host keys in /etc/ssh/ssh_known_hosts</span><br><span class="line">#HostbasedAuthentication no</span><br><span class="line"># Change to yes if you don't trust ~/.ssh/known_hosts for</span><br><span class="line"># HostbasedAuthentication</span><br><span class="line">#IgnoreUserKnownHosts no</span><br><span class="line"># Don't read the user's ~/.rhosts and ~/.shosts files</span><br><span class="line">#IgnoreRhosts yes</span><br><span class="line"></span><br><span class="line"># To disable tunneled clear text passwords, change to no here!</span><br><span class="line">#PasswordAuthentication yes</span><br><span class="line">#PermitEmptyPasswords no</span><br><span class="line"></span><br><span class="line"># Change to yes to enable challenge-response passwords (beware issues with</span><br><span class="line"># some PAM modules and threads)</span><br><span class="line">KbdInteractiveAuthentication no</span><br><span class="line"></span><br><span class="line"># Kerberos options</span><br><span class="line">#KerberosAuthentication no</span><br><span class="line">#KerberosOrLocalPasswd yes</span><br><span class="line">#KerberosTicketCleanup yes</span><br><span class="line">#KerberosGetAFSToken no</span><br><span class="line"></span><br><span class="line"># GSSAPI options</span><br><span class="line">#GSSAPIAuthentication no</span><br><span class="line">#GSSAPICleanupCredentials yes</span><br><span class="line">#GSSAPIStrictAcceptorCheck yes</span><br><span class="line">#GSSAPIKeyExchange no</span><br><span class="line"></span><br><span class="line"># Set this to 'yes' to enable PAM authentication, account processing,</span><br><span class="line"># and session processing. If this is enabled, PAM authentication will</span><br><span class="line"># be allowed through the KbdInteractiveAuthentication and</span><br><span class="line"># PasswordAuthentication.  Depending on your PAM configuration,</span><br><span class="line"># PAM authentication via KbdInteractiveAuthentication may bypass</span><br><span class="line"># the setting of "PermitRootLogin without-password".</span><br><span class="line"># If you just want the PAM account and session checks to run without</span><br><span class="line"># PAM authentication, then enable this but set PasswordAuthentication</span><br><span class="line"># and KbdInteractiveAuthentication to 'no'.</span><br><span class="line">UsePAM yes</span><br><span class="line"></span><br><span class="line">#AllowAgentForwarding yes</span><br><span class="line">#AllowTcpForwarding yes</span><br><span class="line">#GatewayPorts no</span><br><span class="line">X11Forwarding yes</span><br><span class="line">#X11DisplayOffset 10</span><br><span class="line">#X11UseLocalhost yes</span><br><span class="line">#PermitTTY yes</span><br><span class="line">PrintMotd no</span><br><span class="line">#PrintLastLog yes</span><br><span class="line">#TCPKeepAlive yes</span><br><span class="line">#PermitUserEnvironment no</span><br><span class="line">#Compression delayed</span><br><span class="line">#ClientAliveInterval 0</span><br><span class="line">#ClientAliveCountMax 3</span><br><span class="line">#UseDNS no</span><br><span class="line">#PidFile /run/sshd.pid</span><br><span class="line">#MaxStartups 10:30:100</span><br><span class="line">#PermitTunnel no</span><br><span class="line">#ChrootDirectory none</span><br><span class="line">#VersionAddendum none</span><br><span class="line"></span><br><span class="line"># no default banner path</span><br><span class="line">#Banner none</span><br><span class="line"></span><br><span class="line"># Allow client to pass locale environment variables</span><br><span class="line">AcceptEnv LANG LC_*</span><br><span class="line"></span><br><span class="line"># override default of no subsystems</span><br><span class="line">Subsystemsftp/usr/lib/openssh/sftp-server</span><br><span class="line"></span><br><span class="line"># Example of overriding settings on a per-user basis</span><br><span class="line">#Match User anoncvs</span><br><span class="line">#X11Forwarding no</span><br><span class="line">#AllowTcpForwarding no</span><br><span class="line">#PermitTTY no</span><br><span class="line">#ForceCommand cvs server</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></div><p>依次解读</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Include /etc/ssh/sshd_config.d/*.conf，</span><br></pre></td></tr></tbody></table></figure></div><p>包含/etc/ssh/sshd_config.d/下的所有以.conf为结尾的配置文件</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#Port 22</span><br><span class="line">#AddressFamily any</span><br><span class="line">#ListenAddress 0.0.0.0</span><br><span class="line">#ListenAddress ::</span><br></pre></td></tr></tbody></table></figure></div><p>默认监听端口为22，监听IPv4和IPv6，监听所有地址</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#HostKey /etc/ssh/ssh_host_rsa_key</span><br><span class="line">#HostKey /etc/ssh/ssh_host_ecdsa_key</span><br><span class="line">#HostKey /etc/ssh/ssh_host_ed25519_key</span><br></pre></td></tr></tbody></table></figure></div><p>加密通信使用的密钥</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#PermitRootLogin prohibit-password</span><br></pre></td></tr></tbody></table></figure></div><p>禁止root使用密码登录</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#StrictModes yes</span><br></pre></td></tr></tbody></table></figure></div><p>启用严格权限检查</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#MaxAuthTries 6</span><br></pre></td></tr></tbody></table></figure></div><p>允许的最大尝试登录次数</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#MaxSessions 10</span><br></pre></td></tr></tbody></table></figure></div><p>SSH连接最多可以开启的会话数</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#PubkeyAuthentication yes</span><br></pre></td></tr></tbody></table></figure></div><p>启用公钥认证</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#AuthorizedKeysFile.ssh/authorized_keys .ssh/authorized_keys2</span><br></pre></td></tr></tbody></table></figure></div><p>存储用户的公钥</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#AuthorizedPrincipalsFile none</span><br></pre></td></tr></tbody></table></figure></div><p>配合OpenSSH证书认证机制</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#HostbasedAuthentication no</span><br></pre></td></tr></tbody></table></figure></div><p>启用主机信任认证</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#IgnoreUserKnownHosts no</span><br><span class="line">#IgnoreRhosts yes</span><br></pre></td></tr></tbody></table></figure></div><p>是否忽略~/.ssh/known_hosts</p><p>禁止使用.rhosts和.shosts</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#PasswordAuthentication yes</span><br></pre></td></tr></tbody></table></figure></div><p>是否允许使用密码登录</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#PermitEmptyPasswords no</span><br></pre></td></tr></tbody></table></figure></div><p>是否允许空密码账户的登录</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">KbdInteractiveAuthentication no</span><br></pre></td></tr></tbody></table></figure></div><p>是否启用键盘交互式认证</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Kerberos options</span><br><span class="line">#KerberosAuthentication no</span><br><span class="line">#KerberosOrLocalPasswd yes</span><br><span class="line">#KerberosTicketCleanup yes</span><br><span class="line">#KerberosGetAFSToken no</span><br></pre></td></tr></tbody></table></figure></div><p>kerbeors协议</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UsePAM yes</span><br></pre></td></tr></tbody></table></figure></div><p>启用PAM认证</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#AllowAgentForwarding yes</span><br><span class="line">#AllowTcpForwarding yes</span><br><span class="line">#GatewayPorts no</span><br><span class="line">X11Forwarding yes</span><br></pre></td></tr></tbody></table></figure></div><p>控制 SSH 支持哪些转发功能：</p><p>AgentForwarding：允许 SSH Agent 代理密钥转发</p><p>TcpForwarding：允许端口转发</p><p>GatewayPorts：是否允许远程主机连接转发端口</p><p>X11Forwarding：是否允许图形界面程序从远程通过 SSH 显示（例如运行远程 Firefox）</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PrintMotd no</span><br></pre></td></tr></tbody></table></figure></div><p>是否打印登录欢迎信息</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AcceptEnv LANG LC_*</span><br></pre></td></tr></tbody></table></figure></div><p>允许客户端传递哪些环境变量</p><h3 id="（2）客户端配置文件"><a href="#（2）客户端配置文件" class="headerlink" title="（2）客户端配置文件"></a>（2）客户端配置文件</h3><p>读取服务端配置文件</p><p><img lazyload="" src="/images/loading.svg" data-src="/%E7%AC%AC%E4%B8%80%E8%8A%82%E4%BD%9C%E4%B8%9A.assets/image-20250411142017054.png" alt="image-20250411142017054"></p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"># This is the ssh client system-wide configuration file.  See</span><br><span class="line"># ssh_config(5) for more information.  This file provides defaults for</span><br><span class="line"># users, and the values can be changed in per-user configuration files</span><br><span class="line"># or on the command line.</span><br><span class="line"></span><br><span class="line"># Configuration data is parsed as follows:</span><br><span class="line">#  1. command line options</span><br><span class="line">#  2. user-specific file</span><br><span class="line">#  3. system-wide file</span><br><span class="line"># Any configuration value is only changed the first time it is set.</span><br><span class="line"># Thus, host-specific definitions should be at the beginning of the</span><br><span class="line"># configuration file, and defaults at the end.</span><br><span class="line"></span><br><span class="line"># Site-wide defaults for some commonly used options.  For a comprehensive</span><br><span class="line"># list of available options, their meanings and defaults, please see the</span><br><span class="line"># ssh_config(5) man page.</span><br><span class="line"></span><br><span class="line">Include /etc/ssh/ssh_config.d/*.conf</span><br><span class="line"></span><br><span class="line">Host *</span><br><span class="line">#   ForwardAgent no</span><br><span class="line">#   ForwardX11 no</span><br><span class="line">#   ForwardX11Trusted yes</span><br><span class="line">#   PasswordAuthentication yes</span><br><span class="line">#   HostbasedAuthentication no</span><br><span class="line">#   GSSAPIAuthentication no</span><br><span class="line">#   GSSAPIDelegateCredentials no</span><br><span class="line">#   GSSAPIKeyExchange no</span><br><span class="line">#   GSSAPITrustDNS no</span><br><span class="line">#   BatchMode no</span><br><span class="line">#   CheckHostIP no</span><br><span class="line">#   AddressFamily any</span><br><span class="line">#   ConnectTimeout 0</span><br><span class="line">#   StrictHostKeyChecking ask</span><br><span class="line">#   IdentityFile ~/.ssh/id_rsa</span><br><span class="line">#   IdentityFile ~/.ssh/id_dsa</span><br><span class="line">#   IdentityFile ~/.ssh/id_ecdsa</span><br><span class="line">#   IdentityFile ~/.ssh/id_ed25519</span><br><span class="line">#   Port 22</span><br><span class="line">#   Ciphers aes128-ctr,aes192-ctr,aes256-ctr,aes128-cbc,3des-cbc</span><br><span class="line">#   MACs hmac-md5,hmac-sha1,umac-64@openssh.com</span><br><span class="line">#   EscapeChar ~</span><br><span class="line">#   Tunnel no</span><br><span class="line">#   TunnelDevice any:any</span><br><span class="line">#   PermitLocalCommand no</span><br><span class="line">#   VisualHostKey no</span><br><span class="line">#   ProxyCommand ssh -q -W %h:%p gateway.example.com</span><br><span class="line">#   RekeyLimit 1G 1h</span><br><span class="line">#   UserKnownHostsFile ~/.ssh/known_hosts.d/%k</span><br><span class="line">    SendEnv LANG LC_*</span><br><span class="line">    HashKnownHosts yes</span><br><span class="line">    GSSAPIAuthentication yes</span><br></pre></td></tr></tbody></table></figure></div><p>依次解读</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># Configuration data is parsed as follows:</span><br><span class="line">#  1. command line options</span><br><span class="line">#  2. user-specific file</span><br><span class="line">#  3. system-wide file</span><br></pre></td></tr></tbody></table></figure></div><p>配置数据按照以下优先级解析配置文件：命令行选项，用户特定文件，系统默认设置</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Include /etc/ssh/ssh_config.d/*.conf</span><br></pre></td></tr></tbody></table></figure></div><p>包含该目录下的所有配置文件</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Host *</span><br></pre></td></tr></tbody></table></figure></div><p>下面的配置应用于所有配置主机</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#   ForwardAgent no</span><br><span class="line">#   ForwardX11 no</span><br><span class="line">#   ForwardX11Trusted yes</span><br></pre></td></tr></tbody></table></figure></div><p>转发相关配置</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#   PasswordAuthentication yes</span><br><span class="line">#   HostbasedAuthentication no</span><br></pre></td></tr></tbody></table></figure></div><p>通过密码进行SSH登录</p><p>是否启用主机认证</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#   BatchMode no</span><br><span class="line">#   CheckHostIP no</span><br></pre></td></tr></tbody></table></figure></div><p>批量模式下是否启用SSH客户端的非交互式模式</p><p>是否检查主机IP</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#   AddressFamily any</span><br></pre></td></tr></tbody></table></figure></div><p>SSH使用的地址类型</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#   ConnectTimeout 0</span><br></pre></td></tr></tbody></table></figure></div><p>连接超时时间，0表示永不超时</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#   StrictHostKeyChecking ask</span><br></pre></td></tr></tbody></table></figure></div><p>如何验证远程主机公钥</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#   IdentityFile ~/.ssh/id_rsa</span><br><span class="line">#   IdentityFile ~/.ssh/id_dsa</span><br><span class="line">#   IdentityFile ~/.ssh/id_ecdsa</span><br><span class="line">#   IdentityFile ~/.ssh/id_ed25519</span><br></pre></td></tr></tbody></table></figure></div><p>私钥文件</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#   Port 22</span><br></pre></td></tr></tbody></table></figure></div><p>访问端口</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#   Ciphers aes128-ctr,aes192-ctr,aes256-ctr,aes128-cbc,3des-cbc</span><br></pre></td></tr></tbody></table></figure></div><p>密码算法</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#   MACs hmac-md5,hmac-sha1,umac-64@openssh.com</span><br></pre></td></tr></tbody></table></figure></div><p>MAC算法</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SendEnv LANG LC_*</span><br><span class="line">HashKnownHosts yes</span><br><span class="line">GSSAPIAuthentication yes</span><br></pre></td></tr></tbody></table></figure></div><p>要发送的环境变量</p><p>启用已知主机文件的哈希存储</p><p>启用GSSAPI身份验证</p><h2 id="三、二层环境搭建"><a href="#三、二层环境搭建" class="headerlink" title="三、二层环境搭建"></a>三、二层环境搭建</h2><p><img lazyload="" src="/images/loading.svg" data-src="/%E7%AC%AC%E4%B8%80%E8%8A%82%E4%BD%9C%E4%B8%9A.assets/image-20250411214740332.png" alt="image-20250411214740332"></p><p>将虚拟机网络适配器设置为桥接模式，则不同主机内处于同一个二层网络中，将其它主机也修改为桥接模式，测试连通性</p><p><img lazyload="" src="/images/loading.svg" data-src="/%E7%AC%AC%E4%B8%80%E8%8A%82%E4%BD%9C%E4%B8%9A.assets/image-20250411215135310.png" alt="image-20250411215135310"></p><p>可以ping通，这几个设备同处在二层网络环境中</p><h2 id="四、爆破流量-日志分析"><a href="#四、爆破流量-日志分析" class="headerlink" title="四、爆破流量/日志分析"></a>四、爆破流量/日志分析</h2><p>开启hydra爆破，并使用wireshark进行抓包，</p><p><img lazyload="" src="/images/loading.svg" data-src="/%E7%AC%AC%E4%B8%80%E8%8A%82%E4%BD%9C%E4%B8%9A.assets/image-20250411161247362.png" alt="image-20250411161247362"></p><p><img lazyload="" src="/images/loading.svg" data-src="/%E7%AC%AC%E4%B8%80%E8%8A%82%E4%BD%9C%E4%B8%9A.assets/image-20250411160959612.png" alt="image-20250411160959612"></p><p>可以看出，存在很多TCP和SSH数据包，且TCP数据包中包含大量的SYN数据包，包含多次的连接尝试和会话中断，即进行了多次的连接尝试进行暴力破解枚举攻击</p><p>查看服务端SSH相关日志</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo grep "Failed password" /var/log/auth.log</span><br></pre></td></tr></tbody></table></figure></div><p><img lazyload="" src="/images/loading.svg" data-src="/%E7%AC%AC%E4%B8%80%E8%8A%82%E4%BD%9C%E4%B8%9A.assets/image-20250411162320492.png" alt="image-20250411162320492"></p><p>可以看出存在大量的密码输入错误的尝试信息</p><p><img lazyload="" src="/images/loading.svg" data-src="/%E7%AC%AC%E4%B8%80%E8%8A%82%E4%BD%9C%E4%B8%9A.assets/image-20250411162714244.png" alt="image-20250411162714244"></p><p>SSH日志，包括连接失败和连接成功等相关信息。</p><h2 id="五、SSH后门"><a href="#五、SSH后门" class="headerlink" title="五、SSH后门"></a>五、SSH后门</h2><p>对于使用爆破攻击成功登录的攻击者，可以通过在该用户的认证密钥文件authorized_keys下注入自己的公钥信息，可以绕过传统的密码认证机制，攻击者可以通过SSH登录目标系统并且不需要输入口令。</p><p>首先，攻击者生成一对RSA密钥</p><p><img lazyload="" src="/images/loading.svg" data-src="/%E7%AC%AC%E4%B8%80%E8%8A%82%E4%BD%9C%E4%B8%9A.assets/image-20250411173249762.png" alt="image-20250411173249762"></p><p>输入爆破得到的口令登录</p><p><img lazyload="" src="/images/loading.svg" data-src="/%E7%AC%AC%E4%B8%80%E8%8A%82%E4%BD%9C%E4%B8%9A.assets/image-20250411173403615.png" alt="image-20250411173403615"></p><p>寻找目标用户的authorized_keys，并其中添加自己的公钥信息</p><p>下面是原认证密钥文件内容</p><p><img lazyload="" src="/images/loading.svg" data-src="/%E7%AC%AC%E4%B8%80%E8%8A%82%E4%BD%9C%E4%B8%9A.assets/image-20250411173602309.png" alt="image-20250411173602309"></p><p>将公钥上传到服务器上</p><p><img lazyload="" src="/images/loading.svg" data-src="/%E7%AC%AC%E4%B8%80%E8%8A%82%E4%BD%9C%E4%B8%9A.assets/image-20250411174132581.png" alt="image-20250411174132581"></p><p>将公钥信息添加到authorized_keys中<br><img lazyload="" src="/images/loading.svg" data-src="/%E7%AC%AC%E4%B8%80%E8%8A%82%E4%BD%9C%E4%B8%9A.assets/image-20250411174248772.png" alt="image-20250411174248772"></p><p>重新尝试通过后门公钥登录</p><p><img lazyload="" src="/images/loading.svg" data-src="/%E7%AC%AC%E4%B8%80%E8%8A%82%E4%BD%9C%E4%B8%9A.assets/image-20250411174413557.png" alt="image-20250411174413557"></p><p>可以看出，无需通过口令，通过后门公钥可以成功连接</p><h2 id="六、隧道（正反）"><a href="#六、隧道（正反）" class="headerlink" title="六、隧道（正反）"></a>六、隧道（正反）</h2><h3 id="1-正向隧道"><a href="#1-正向隧道" class="headerlink" title="(1) 正向隧道"></a>(1) 正向隧道</h3><p>允许将本地端口的流量通过SSH隧道转发到远程服务器的端口上，可以访问局域网内不可直接访问的服务，绕过防火墙的限制。</p><p>例如，在服务器的pwn目录中开启一个http服务，端口为8080</p><p><img lazyload="" src="/images/loading.svg" data-src="/%E7%AC%AC%E4%B8%80%E8%8A%82%E4%BD%9C%E4%B8%9A.assets/image-20250411202007115.png" alt="image-20250411202007115"></p><p>在客户端开启一个正向隧道，将客户端8081端口映射到服务器的8080端口以实现通过SSH隧道访问服务器上的http服务</p><p><img lazyload="" src="/images/loading.svg" data-src="/%E7%AC%AC%E4%B8%80%E8%8A%82%E4%BD%9C%E4%B8%9A.assets/image-20250411202201285.png" alt="image-20250411202201285"></p><p><img lazyload="" src="/images/loading.svg" data-src="/%E7%AC%AC%E4%B8%80%E8%8A%82%E4%BD%9C%E4%B8%9A.assets/image-20250411202244335.png" alt="image-20250411202244335"></p><p>成功通过SSH隧道实现了远程服务器http服务的访问</p><h3 id="2-反向隧道"><a href="#2-反向隧道" class="headerlink" title="(2) 反向隧道"></a>(2) 反向隧道</h3><p>与正向隧道类似，是允许远程服务器访问客户端的某个服务，将服务器端口映射到本机上的端口。 可以绕过防火墙</p><p>在客户端Desktop目录开启http服务，端口为8082</p><p><img lazyload="" src="/images/loading.svg" data-src="/%E7%AC%AC%E4%B8%80%E8%8A%82%E4%BD%9C%E4%B8%9A.assets/image-20250411210138179.png" alt="image-20250411210138179"></p><p>开启反向隧道</p><p><img lazyload="" src="/images/loading.svg" data-src="/%E7%AC%AC%E4%B8%80%E8%8A%82%E4%BD%9C%E4%B8%9A.assets/image-20250411205837561.png" alt="image-20250411205837561"></p><p>在服务端通过反向隧道访问</p><p><img lazyload="" src="/images/loading.svg" data-src="/%E7%AC%AC%E4%B8%80%E8%8A%82%E4%BD%9C%E4%B8%9A.assets/image-20250411210222091.png" alt="image-20250411210222091"></p><p>成功通过反向隧道访问。</p><h2 id="七、Vulnhub-SSH"><a href="#七、Vulnhub-SSH" class="headerlink" title="七、Vulnhub/SSH"></a>七、Vulnhub/SSH</h2><p>以RAVEN1靶场为例，学习SSH等相关知识</p><p>首先探测靶机内的相关主机地址</p><p><img lazyload="" src="/images/loading.svg" data-src="/%E7%AC%AC%E4%B8%80%E8%8A%82%E4%BD%9C%E4%B8%9A.assets/image-20250412124729847.png" alt="image-20250412124729847"></p><p>探测到IP地址为192.168.88.137的主机</p><p>探测其开启的服务</p><p><img lazyload="" src="/images/loading.svg" data-src="/%E7%AC%AC%E4%B8%80%E8%8A%82%E4%BD%9C%E4%B8%9A.assets/image-20250412124920581.png" alt="image-20250412124920581"></p><p>靶机开启了22ssh服务，80http服务以及111rpcbind服务</p><p>爆破目录，发现wordpress，探测wordpress漏洞</p><p><img lazyload="" src="/images/loading.svg" data-src="/%E7%AC%AC%E4%B8%80%E8%8A%82%E4%BD%9C%E4%B8%9A.assets/image-20250412132727452.png" alt="image-20250412132727452"></p><p>探测到用户michael</p><p>使用ssh爆破尝试获得用户shell</p><p><img lazyload="" src="/images/loading.svg" data-src="/%E7%AC%AC%E4%B8%80%E8%8A%82%E4%BD%9C%E4%B8%9A.assets/image-20250412132823196.png" alt="image-20250412132823196"></p><p>成功爆破，口令为michael</p><p>远程登录</p><p><img lazyload="" src="/images/loading.svg" data-src="/%E7%AC%AC%E4%B8%80%E8%8A%82%E4%BD%9C%E4%B8%9A.assets/image-20250412132958282.png" alt="image-20250412132958282"></p><p>获得了用户shell</p><p><img lazyload="" src="/images/loading.svg" data-src="/%E7%AC%AC%E4%B8%80%E8%8A%82%E4%BD%9C%E4%B8%9A.assets/image-20250412133336506.png" alt="image-20250412133336506"></p><p><img lazyload="" src="/images/loading.svg" data-src="/%E7%AC%AC%E4%B8%80%E8%8A%82%E4%BD%9C%E4%B8%9A.assets/image-20250412133358570.png" alt="image-20250412133358570"></p><p>获得了两个flag</p>]]></content>
    
    
    <summary type="html">无</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>test title</title>
    <link href="http://example.com/2025/03/09/Test_theme/"/>
    <id>http://example.com/2025/03/09/Test_theme/</id>
    <published>2025-03-09T08:42:30.856Z</published>
    <updated>2025-03-09T08:59:57.973Z</updated>
    
    <content type="html"><![CDATA[<p>test theme</p>]]></content>
    
    
    <summary type="html">test description</summary>
    
    
    
    
  </entry>
  
</feed>
