[{"title":"某学校某课程的作业","date":"2025-04-25T07:03:02.565Z","path":"2025/04/25/第一节作业/","text":"第一节课作业 ssh爆破和后门一、上课作业创建用户，并设置密码 ![屏幕截图 2025-03-29 170121](file://E:\\blog\\source_posts\\第一节作业.assets\\屏幕截图 2025-03-29 170121.png?lastModify=1760532833) 开启SSH服务 kaliuser远程登录 hydra爆破 二、C/S配置文件解读（1）服务端配置文件读取服务端配置文件 1cat /etc/ssh/sshd_config 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122# This is the sshd server system-wide configuration file. See# sshd_config(5) for more information.# This sshd was compiled with PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games# The strategy used for options in the default sshd_config shipped with# OpenSSH is to specify options with their default value where# possible, but leave them commented. Uncommented options override the# default value.Include /etc/ssh/sshd_config.d/*.conf#Port 22#AddressFamily any#ListenAddress 0.0.0.0#ListenAddress ::#HostKey /etc/ssh/ssh_host_rsa_key#HostKey /etc/ssh/ssh_host_ecdsa_key#HostKey /etc/ssh/ssh_host_ed25519_key# Ciphers and keying#RekeyLimit default none# Logging#SyslogFacility AUTH#LogLevel INFO# Authentication:#LoginGraceTime 2m#PermitRootLogin prohibit-password#StrictModes yes#MaxAuthTries 6#MaxSessions 10#PubkeyAuthentication yes# Expect .ssh/authorized_keys2 to be disregarded by default in future.#AuthorizedKeysFile .ssh/authorized_keys .ssh/authorized_keys2#AuthorizedPrincipalsFile none#AuthorizedKeysCommand none#AuthorizedKeysCommandUser nobody# For this to work you will also need host keys in /etc/ssh/ssh_known_hosts#HostbasedAuthentication no# Change to yes if you don't trust ~/.ssh/known_hosts for# HostbasedAuthentication#IgnoreUserKnownHosts no# Don't read the user's ~/.rhosts and ~/.shosts files#IgnoreRhosts yes# To disable tunneled clear text passwords, change to no here!#PasswordAuthentication yes#PermitEmptyPasswords no# Change to yes to enable challenge-response passwords (beware issues with# some PAM modules and threads)KbdInteractiveAuthentication no# Kerberos options#KerberosAuthentication no#KerberosOrLocalPasswd yes#KerberosTicketCleanup yes#KerberosGetAFSToken no# GSSAPI options#GSSAPIAuthentication no#GSSAPICleanupCredentials yes#GSSAPIStrictAcceptorCheck yes#GSSAPIKeyExchange no# Set this to 'yes' to enable PAM authentication, account processing,# and session processing. If this is enabled, PAM authentication will# be allowed through the KbdInteractiveAuthentication and# PasswordAuthentication. Depending on your PAM configuration,# PAM authentication via KbdInteractiveAuthentication may bypass# the setting of \"PermitRootLogin without-password\".# If you just want the PAM account and session checks to run without# PAM authentication, then enable this but set PasswordAuthentication# and KbdInteractiveAuthentication to 'no'.UsePAM yes#AllowAgentForwarding yes#AllowTcpForwarding yes#GatewayPorts noX11Forwarding yes#X11DisplayOffset 10#X11UseLocalhost yes#PermitTTY yesPrintMotd no#PrintLastLog yes#TCPKeepAlive yes#PermitUserEnvironment no#Compression delayed#ClientAliveInterval 0#ClientAliveCountMax 3#UseDNS no#PidFile /run/sshd.pid#MaxStartups 10:30:100#PermitTunnel no#ChrootDirectory none#VersionAddendum none# no default banner path#Banner none# Allow client to pass locale environment variablesAcceptEnv LANG LC_*# override default of no subsystemsSubsystem sftp /usr/lib/openssh/sftp-server# Example of overriding settings on a per-user basis#Match User anoncvs# X11Forwarding no# AllowTcpForwarding no# PermitTTY no# ForceCommand cvs server 依次解读 1Include /etc/ssh/sshd_config.d/*.conf， 包含/etc/ssh/sshd_config.d/下的所有以.conf为结尾的配置文件 1234#Port 22#AddressFamily any#ListenAddress 0.0.0.0#ListenAddress :: 默认监听端口为22，监听IPv4和IPv6，监听所有地址 123#HostKey /etc/ssh/ssh_host_rsa_key#HostKey /etc/ssh/ssh_host_ecdsa_key#HostKey /etc/ssh/ssh_host_ed25519_key 加密通信使用的密钥 1#PermitRootLogin prohibit-password 禁止root使用密码登录 1#StrictModes yes 启用严格权限检查 1#MaxAuthTries 6 允许的最大尝试登录次数 1#MaxSessions 10 SSH连接最多可以开启的会话数 1#PubkeyAuthentication yes 启用公钥认证 1#AuthorizedKeysFile .ssh/authorized_keys .ssh/authorized_keys2 存储用户的公钥 1#AuthorizedPrincipalsFile none 配合OpenSSH证书认证机制 1#HostbasedAuthentication no 启用主机信任认证 12#IgnoreUserKnownHosts no#IgnoreRhosts yes 是否忽略~/.ssh/known_hosts 禁止使用.rhosts和.shosts 1#PasswordAuthentication yes 是否允许使用密码登录 1#PermitEmptyPasswords no 是否允许空密码账户的登录 1KbdInteractiveAuthentication no 是否启用键盘交互式认证 12345# Kerberos options#KerberosAuthentication no#KerberosOrLocalPasswd yes#KerberosTicketCleanup yes#KerberosGetAFSToken no kerbeors协议 1UsePAM yes 启用PAM认证 1234#AllowAgentForwarding yes#AllowTcpForwarding yes#GatewayPorts noX11Forwarding yes 控制 SSH 支持哪些转发功能： AgentForwarding：允许 SSH Agent 代理密钥转发 TcpForwarding：允许端口转发 GatewayPorts：是否允许远程主机连接转发端口 X11Forwarding：是否允许图形界面程序从远程通过 SSH 显示（例如运行远程 Firefox） 1PrintMotd no 是否打印登录欢迎信息 1AcceptEnv LANG LC_* 允许客户端传递哪些环境变量 （2）客户端配置文件读取服务端配置文件 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152# This is the ssh client system-wide configuration file. See# ssh_config(5) for more information. This file provides defaults for# users, and the values can be changed in per-user configuration files# or on the command line.# Configuration data is parsed as follows:# 1. command line options# 2. user-specific file# 3. system-wide file# Any configuration value is only changed the first time it is set.# Thus, host-specific definitions should be at the beginning of the# configuration file, and defaults at the end.# Site-wide defaults for some commonly used options. For a comprehensive# list of available options, their meanings and defaults, please see the# ssh_config(5) man page.Include /etc/ssh/ssh_config.d/*.confHost *# ForwardAgent no# ForwardX11 no# ForwardX11Trusted yes# PasswordAuthentication yes# HostbasedAuthentication no# GSSAPIAuthentication no# GSSAPIDelegateCredentials no# GSSAPIKeyExchange no# GSSAPITrustDNS no# BatchMode no# CheckHostIP no# AddressFamily any# ConnectTimeout 0# StrictHostKeyChecking ask# IdentityFile ~/.ssh/id_rsa# IdentityFile ~/.ssh/id_dsa# IdentityFile ~/.ssh/id_ecdsa# IdentityFile ~/.ssh/id_ed25519# Port 22# Ciphers aes128-ctr,aes192-ctr,aes256-ctr,aes128-cbc,3des-cbc# MACs hmac-md5,hmac-sha1,umac-64@openssh.com# EscapeChar ~# Tunnel no# TunnelDevice any:any# PermitLocalCommand no# VisualHostKey no# ProxyCommand ssh -q -W %h:%p gateway.example.com# RekeyLimit 1G 1h# UserKnownHostsFile ~/.ssh/known_hosts.d/%k SendEnv LANG LC_* HashKnownHosts yes GSSAPIAuthentication yes 依次解读 1234# Configuration data is parsed as follows:# 1. command line options# 2. user-specific file# 3. system-wide file 配置数据按照以下优先级解析配置文件：命令行选项，用户特定文件，系统默认设置 1Include /etc/ssh/ssh_config.d/*.conf 包含该目录下的所有配置文件 1Host * 下面的配置应用于所有配置主机 123# ForwardAgent no# ForwardX11 no# ForwardX11Trusted yes 转发相关配置 12# PasswordAuthentication yes# HostbasedAuthentication no 通过密码进行SSH登录 是否启用主机认证 12# BatchMode no# CheckHostIP no 批量模式下是否启用SSH客户端的非交互式模式 是否检查主机IP 1# AddressFamily any SSH使用的地址类型 1# ConnectTimeout 0 连接超时时间，0表示永不超时 1# StrictHostKeyChecking ask 如何验证远程主机公钥 1234# IdentityFile ~/.ssh/id_rsa# IdentityFile ~/.ssh/id_dsa# IdentityFile ~/.ssh/id_ecdsa# IdentityFile ~/.ssh/id_ed25519 私钥文件 1# Port 22 访问端口 1# Ciphers aes128-ctr,aes192-ctr,aes256-ctr,aes128-cbc,3des-cbc 密码算法 1# MACs hmac-md5,hmac-sha1,umac-64@openssh.com MAC算法 123SendEnv LANG LC_*HashKnownHosts yesGSSAPIAuthentication yes 要发送的环境变量 启用已知主机文件的哈希存储 启用GSSAPI身份验证 三、二层环境搭建 将虚拟机网络适配器设置为桥接模式，则不同主机内处于同一个二层网络中，将其它主机也修改为桥接模式，测试连通性 可以ping通，这几个设备同处在二层网络环境中 四、爆破流量/日志分析开启hydra爆破，并使用wireshark进行抓包， 可以看出，存在很多TCP和SSH数据包，且TCP数据包中包含大量的SYN数据包，包含多次的连接尝试和会话中断，即进行了多次的连接尝试进行暴力破解枚举攻击 查看服务端SSH相关日志 1sudo grep \"Failed password\" /var/log/auth.log 可以看出存在大量的密码输入错误的尝试信息 SSH日志，包括连接失败和连接成功等相关信息。 五、SSH后门对于使用爆破攻击成功登录的攻击者，可以通过在该用户的认证密钥文件authorized_keys下注入自己的公钥信息，可以绕过传统的密码认证机制，攻击者可以通过SSH登录目标系统并且不需要输入口令。 首先，攻击者生成一对RSA密钥 输入爆破得到的口令登录 寻找目标用户的authorized_keys，并其中添加自己的公钥信息 下面是原认证密钥文件内容 将公钥上传到服务器上 将公钥信息添加到authorized_keys中 重新尝试通过后门公钥登录 可以看出，无需通过口令，通过后门公钥可以成功连接 六、隧道（正反）(1) 正向隧道允许将本地端口的流量通过SSH隧道转发到远程服务器的端口上，可以访问局域网内不可直接访问的服务，绕过防火墙的限制。 例如，在服务器的pwn目录中开启一个http服务，端口为8080 在客户端开启一个正向隧道，将客户端8081端口映射到服务器的8080端口以实现通过SSH隧道访问服务器上的http服务 成功通过SSH隧道实现了远程服务器http服务的访问 (2) 反向隧道与正向隧道类似，是允许远程服务器访问客户端的某个服务，将服务器端口映射到本机上的端口。 可以绕过防火墙 在客户端Desktop目录开启http服务，端口为8082 开启反向隧道 在服务端通过反向隧道访问 成功通过反向隧道访问。 七、Vulnhub/SSH以RAVEN1靶场为例，学习SSH等相关知识 首先探测靶机内的相关主机地址 探测到IP地址为192.168.88.137的主机 探测其开启的服务 靶机开启了22ssh服务，80http服务以及111rpcbind服务 爆破目录，发现wordpress，探测wordpress漏洞 探测到用户michael 使用ssh爆破尝试获得用户shell 成功爆破，口令为michael 远程登录 获得了用户shell 获得了两个flag","tags":[]},{"title":"test title","date":"2025-03-09T08:42:30.856Z","path":"2025/03/09/Test_theme/","text":"test theme","tags":[]}]